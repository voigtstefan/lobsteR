<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Create a LOBSTER data request (one row per trading day) — request_query • lobsteR</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create a LOBSTER data request (one row per trading day) — request_query"><meta name="description" content="Construct a request describing which trading-day files to ask LOBSTER for.
For each symbol and date range the function expands the range to one row per
calendar day, converts the level to integer, and (optionally) validates the
requested days by removing weekends, NYSE holidays and any days already
present in the provided account archive."><meta property="og:description" content="Construct a request describing which trading-day files to ask LOBSTER for.
For each symbol and date range the function expands the range to one row per
calendar day, converts the level to integer, and (optionally) validates the
requested days by removing weekends, NYSE holidays and any days already
present in the provided account archive."><meta property="og:image" content="https://voigtstefan.github.io/lobsteR/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">lobsteR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/voigtstefan/lobsteR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Create a LOBSTER data request (one row per trading day)</h1>
      <small class="dont-index">Source: <a href="https://github.com/voigtstefan/lobsteR/blob/main/R/request.R" class="external-link"><code>R/request.R</code></a></small>
      <div class="d-none name"><code>request_query.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Construct a request describing which trading-day files to ask LOBSTER for.
For each symbol and date range the function expands the range to one row per
calendar day, converts the level to integer, and (optionally) validates the
requested days by removing weekends, NYSE holidays and any days already
present in the provided account archive.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">request_query</span><span class="op">(</span></span>
<span>  <span class="va">symbol</span>,</span>
<span>  <span class="va">start_date</span>,</span>
<span>  <span class="va">end_date</span>,</span>
<span>  <span class="va">level</span>,</span>
<span>  validate <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  account_archive <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  frequency <span class="op">=</span> <span class="st">"1 day"</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-symbol">symbol<a class="anchor" aria-label="anchor" href="#arg-symbol"></a></dt>
<dd><p>character vector One or more ticker symbols (e.g. <code>"AAPL"</code>).
Each element is paired with the corresponding elements of <code>start_date</code>,
<code>end_date</code> and <code>level</code>. Recycling follows base R rules; mismatched lengths
should be avoided.</p></dd>


<dt id="arg-start-date">start_date<a class="anchor" aria-label="anchor" href="#arg-start-date"></a></dt>
<dd><p>Date-like (Date or character) Start date(s) for the
requested range(s). Converted with <code><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date()</a></code>.</p></dd>


<dt id="arg-end-date">end_date<a class="anchor" aria-label="anchor" href="#arg-end-date"></a></dt>
<dd><p>Date-like (Date or character) End date(s) for the
requested range(s). Converted with <code><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date()</a></code>.</p></dd>


<dt id="arg-level">level<a class="anchor" aria-label="anchor" href="#arg-level"></a></dt>
<dd><p>integer(1) Required order-book snapshot level (e.g. <code>1</code>, <code>2</code>,
<code>10</code>).</p></dd>


<dt id="arg-validate">validate<a class="anchor" aria-label="anchor" href="#arg-validate"></a></dt>
<dd><p>logical(1) If <code>TRUE</code> (default) remove weekend days and NYSE
holidays. When <code>account_archive</code> is also supplied, days already present in
the archive are additionally removed to avoid duplicate requests.</p></dd>


<dt id="arg-account-archive">account_archive<a class="anchor" aria-label="anchor" href="#arg-account-archive"></a></dt>
<dd><p>data.frame or tibble, optional Archive table as
returned by <code><a href="account_archive.html">account_archive()</a></code>. When provided, rows already present in
the archive (matched on symbol, start_date, end_date, and level) are
excluded.</p></dd>


<dt id="arg-frequency">frequency<a class="anchor" aria-label="anchor" href="#arg-frequency"></a></dt>
<dd><p>character(1) Frequency string passed to <code><a href="https://rdrr.io/r/base/seq.Date.html" class="external-link">seq.Date()</a></code>.
Defaults to <code>"1 day"</code> (one row per trading day). Use <code>"1 month"</code> for
large date ranges to reduce the number of individual requests sent to the
LOBSTER server. Validation (<code>validate = TRUE</code>) is only applied when
<code>frequency == "1 day"</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A data.frame with one row per period and columns:</p><ul><li><p><code>symbol</code>: character</p></li>
<li><p><code>start_date</code>: Date — start of the period (equal to <code>end_date</code> for daily
requests)</p></li>
<li><p><code>end_date</code>: Date — end of the period</p></li>
<li><p><code>level</code>: integer</p></li>
</ul><p>When <code>validate = TRUE</code> and <code>frequency = "1 day"</code>, weekend days and NYSE
holidays are silently removed, so the output typically contains fewer rows
than the full calendar span of the requested date range.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function performs no network activity. Use <code><a href="request_submit.html">request_submit()</a></code>
to send the generated request to an authenticated LOBSTER session.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="request_submit.html">request_submit()</a></code>, <code><a href="account_archive.html">account_archive()</a></code>, <code><a href="account_login.html">account_login()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Single symbol, one-week range (weekends and holidays removed automatically)</span></span></span>
<span class="r-in"><span><span class="fu">request_query</span><span class="op">(</span><span class="st">"AAPL"</span>, <span class="st">"2023-01-02"</span>, <span class="st">"2023-01-06"</span>, level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   symbol start_date   end_date level</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2   AAPL 2023-01-03 2023-01-03     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3   AAPL 2023-01-04 2023-01-04     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4   AAPL 2023-01-05 2023-01-05     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5   AAPL 2023-01-06 2023-01-06     1</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Multiple symbols with paired date ranges</span></span></span>
<span class="r-in"><span><span class="fu">request_query</span><span class="op">(</span></span></span>
<span class="r-in"><span>  symbol     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AAPL"</span>, <span class="st">"MSFT"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  start_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2023-01-03"</span>, <span class="st">"2023-02-01"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  end_date   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2023-01-05"</span>, <span class="st">"2023-02-03"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  level      <span class="op">=</span> <span class="fl">1</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   symbol start_date   end_date level</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1   AAPL 2023-01-03 2023-01-03     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2   AAPL 2023-01-04 2023-01-04     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3   AAPL 2023-01-05 2023-01-05     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4   MSFT 2023-02-01 2023-02-01     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5   MSFT 2023-02-02 2023-02-02     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6   MSFT 2023-02-03 2023-02-03     1</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Monthly frequency for a large date range (no per-day expansion)</span></span></span>
<span class="r-in"><span><span class="fu">request_query</span><span class="op">(</span></span></span>
<span class="r-in"><span>  symbol     <span class="op">=</span> <span class="st">"SPY"</span>,</span></span>
<span class="r-in"><span>  start_date <span class="op">=</span> <span class="st">"2022-01-01"</span>,</span></span>
<span class="r-in"><span>  end_date   <span class="op">=</span> <span class="st">"2022-12-31"</span>,</span></span>
<span class="r-in"><span>  level      <span class="op">=</span> <span class="fl">10</span>,</span></span>
<span class="r-in"><span>  frequency  <span class="op">=</span> <span class="st">"1 month"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    symbol start_date   end_date level</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     SPY 2022-01-01 2022-01-31    10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2     SPY 2022-02-01 2022-02-28    10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3     SPY 2022-03-01 2022-03-31    10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4     SPY 2022-04-01 2022-04-30    10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5     SPY 2022-05-01 2022-05-31    10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6     SPY 2022-06-01 2022-06-30    10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7     SPY 2022-07-01 2022-07-31    10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8     SPY 2022-08-01 2022-08-31    10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9     SPY 2022-09-01 2022-09-30    10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10    SPY 2022-10-01 2022-10-31    10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11    SPY 2022-11-01 2022-11-30    10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12    SPY 2022-12-01 2022-12-31    10</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Exclude days already in the archive to avoid duplicate requests</span></span></span>
<span class="r-in"><span><span class="va">acct</span>    <span class="op">&lt;-</span> <span class="fu"><a href="account_login.html">account_login</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"LOBSTER_USER"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"LOBSTER_PWD"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">archive</span> <span class="op">&lt;-</span> <span class="fu"><a href="account_archive.html">account_archive</a></span><span class="op">(</span><span class="va">acct</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">req</span> <span class="op">&lt;-</span> <span class="fu">request_query</span><span class="op">(</span></span></span>
<span class="r-in"><span>  symbol          <span class="op">=</span> <span class="st">"AAPL"</span>,</span></span>
<span class="r-in"><span>  start_date      <span class="op">=</span> <span class="st">"2023-01-02"</span>,</span></span>
<span class="r-in"><span>  end_date        <span class="op">=</span> <span class="st">"2023-01-31"</span>,</span></span>
<span class="r-in"><span>  level           <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>  account_archive <span class="op">=</span> <span class="va">archive</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Karol Kulma, Stefan Voigt.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>


---
output: github_document
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

  # lobsteR <img src="man/figures/logo.png" align="right" height="139" alt="" />

<!-- badges: start -->
[![Codecov test coverage](https://codecov.io/gh/voigtstefan/lobsteR/graph/badge.svg)](https://app.codecov.io/gh/voigtstefan/lobsteR)
[![R-CMD-check](https://github.com/voigtstefan/lobsteR/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/voigtstefan/lobsteR/actions/workflows/R-CMD-check.yaml)
<!-- badges: end -->

The goal of lobsteR is to provide a tidy framework to request data from
lobsterdata.com, to download, unzip, and clean the data. The package
focuses on the core functionalities required to get LOBSTER data ready
fast, for subsequent typical high-frequency econometrics applications,
we refer to the `highfrequency` package.

1. Install the package (development version):

You can install the development version of lobsteR from [GitHub](https://github.com/) with:

```{r}
#| eval: false
# install.packages("pak")
pak::pak("voigtstefan/lobsteR")
```

## Request and download data from lobsterdata.com

With `lobsteR` you can connect easily connect with lobsterdata.com using
your own credentials.

```{r}
library(lobsteR)
```

```{r}
lobster_login <- account_login(
  login = Sys.getenv("LOBSTER_USER"),
  pwd   = Sys.getenv("LOBSTER_PWD")
)
```

I recommend to store your credentials in the `.Renviron` file to avoid hardcoding them in your scripts.

Next, we request some data from lobsterdata.com, e.g., message-level
data from *META* for the period from May 1st, 2023 until May 3rd, 2023.
´level´ corresponds to the requested number of orderbook snapshot
levels.

```{r}
data_request <- request_query(
  symbol = "MSFT",
  start_date = "2025-05-01",
  end_date = "2025-05-15",
  level = 10)

data_request
```

Next, submit the requests to LOBSTER (server will process them; this can take time):

```{r}
request_submit(account_login = lobster_login,
               request = data_request)
```

After submitting the request, lobsterdata.com will work on providing the
order book snapshots. Depending on the number of messages to process,
this may take some time. You can close the session during the time, the processing will be done in the background on the servers of Lobster. 
Once done, the requested data is available in your account archive - ready to download!

```{r}
lobster_archive <- account_archive(account_login = lobster_login)
```

When downloading, the data is unzipped automatically (this can be omitted using `unzip = FALSE`)

```{r}
#| eval: false
data_download(
  requested_data = lobster_archive |> filter(symbol == "MSFT"),
  account_login = lobster_login,
  path = "data-lobster")
```

## Data processing on an Unix system

To unzip data, `lobsteR` relies on the `archive` package which, in turn, requires a couple of system dependencies to be installed. On a Debian-based linux system, you can install the required dependencies using the following commands:

```{bash}
#| eval: false
sudo apt-get update
sudo apt-get install -y gpgv gnupg libarchive13t64 liblz4-dev libacl1-dev libext2fs-dev nettle-dev
sudo apt-get install -y libarchive-dev
```
